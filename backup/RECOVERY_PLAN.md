# План восстановления инфраструктуры MediaWiki

## 1. Общая информация

Инфраструктура корпоративного сервиса документации построена на базе MediaWiki и состоит из следующих компонентов:

- Nginx Load Balancer (на хостовой машине)
- VM1 — MediaWiki (web-сервер)
- VM2 — MediaWiki + PostgreSQL (основная база данных)
- VM3 — сервер резервного копирования

Цель плана восстановления — обеспечить быстрое восстановление сервиса при сбоях оборудования или потере данных.

---

## 2. Отказ сервера приложения MediaWiki (VM1 или VM2)

### Симптомы:
- Один из backend-серверов недоступен
- Пользовательский сервис продолжает работать частично

### Действия:
1. Проверить статус серверов MediaWiki.
2. Убедиться, что Nginx Load Balancer перенаправляет трафик на доступный сервер.
3. Восстановить отказавший сервер:
   - перезапустить виртуальную машину
   - проверить работу Nginx и PHP-FPM
   - проверить доступность MediaWiki по HTTP

### Результат:
Сервис остаётся доступным для пользователей за счёт балансировки нагрузки.

---

## 3. Отказ сервера базы данных PostgreSQL (VM2)

### Симптомы:
- MediaWiki сообщает об ошибке подключения к БД
- HTTP-сервис доступен, но страницы не загружаются

### Действия:
1. Проверить состояние PostgreSQL.
2. Перезапустить сервис PostgreSQL.
3. При невозможности восстановления:
   - развернуть PostgreSQL на резервном сервере
   - восстановить базу данных из последней резервной копии
   - обновить параметры подключения в LocalSettings.php

### Результат:
Работа сервиса полностью восстанавливается.

---

## 4. Потеря данных (контент или база данных)

### Восстановление базы данных:
1. Выбрать последнюю резервную копию PostgreSQL.
2. Выполнить восстановление:
   ```bash
   gunzip < backup.sql.gz | psql -U wikiuser my_wiki
